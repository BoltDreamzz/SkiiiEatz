{% extends 'partials/base2.html' %}
{% load static %}
{% load rating_tags %}
{% load humanize %}

{% block title %}{{ eatery.name }} - Eatz{% endblock %}


{% block content %}

<div class="flex z-55 gap-3 items-center mx-3 my-4">
    <button onclick="history.back()"
        class="p-2 flex items-center justify-center min-w-12 h-12 bg-white shadow-md rounded-2xl"><svg
            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
            <path fill-rule="evenodd"
                d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                clip-rule="evenodd" />
        </svg>

    </button>
    Go Back
    <!-- <a href="#" class="">Eatz</a> -->
</div>
<div class="flex items-center justify-center p-3" data-aos="flip-right" data-aos-duration="500">
    <!-- Header -->
    <div class="w-100 flex items-center justify-center mb-3"
        hx-get="{% url 'restaurants:restaurant-status-partial' restaurant.pk %}" hx-trigger="load, every 5s"
        hx-swap="outerHTML" id="restaurant-status-{{ restaurant.pk }}" hx-headers="{cache-control: 'no-cache'}">
        <!-- {% include 'restaurant/_countdown.html' %} -->
        {% include 'restaurant/_status.html' %}
    </div>
</div>

<main class="p-3 min-h-screen max-w-5xl">

    <!-- Restaurant Hero Section -->
    <section class="relative mb-3">
        <div class="h-60 md:h-80 relative overflow-hidden rounded-2xl">
            <img src="{{restaurant.image.url}}" alt="{{restaurant.name}}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-black bg-opacity-20"></div>
            <button class="absolute top-4 right-4 bg-white p-2 shadow-lg rounded-lg">
                <i class="fas fa-heart text-gray-400 text-lg"><svg xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20" fill="currentColor" class="size-5">
                        <path fill-rule="evenodd"
                            d="M14 6a2.5 2.5 0 0 0-4-3 2.5 2.5 0 0 0-4 3H3.25C2.56 6 2 6.56 2 7.25v.5C2 8.44 2.56 9 3.25 9h6V6h1.5v3h6C17.44 9 18 8.44 18 7.75v-.5C18 6.56 17.44 6 16.75 6H14Zm-1-1.5a1 1 0 0 1-1 1h-1v-1a1 1 0 1 1 2 0Zm-6 0a1 1 0 0 0 1 1h1v-1a1 1 0 0 0-2 0Z"
                            clip-rule="evenodd" />
                        <path
                            d="M9.25 10.5H3v4.75A2.75 2.75 0 0 0 5.75 18h3.5v-7.5ZM10.75 18v-7.5H17v4.75A2.75 2.75 0 0 1 14.25 18h-3.5Z" />
                    </svg>
                </i>
            </button>
            <span
                class="px-2 absolute flex items-center gap-2 text-white bottom-4 left-4 py-1 rounded-lg bg-primary border border-white text-sm">
                <i class="fas fa-clock text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                        fill="currentColor" class="size-5">
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-13a.75.75 0 0 0-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 0 0 0-1.5h-3.25V5Z"
                            clip-rule="evenodd" />
                    </svg>
                </i>
                <span> {{restaurant.preparation_time}} min</span>
            </span>
        </div>

        <!-- Restaurant Info Overlay -->
        <div class="rounded-2xl bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-3">
            <div class="max-w-7xl mx-auto">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold mb-2">{{restaurant.name}}</h1>

                    <div class="flex items-center">
                        <div class="flex text-yellow-400 text-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="size-5">
                                <path fill-rule="evenodd"
                                    d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z"
                                    clip-rule="evenodd" />
                            </svg>

                        </div>
                        <span class="text-xs ml-1 mt-1">
                            {{ restaurant.rating }}
                        </span>
                    </div>
                </div>
                <div class="flex items-center justify-between text-sm">

                    <!-- <span>•</span> -->
                    <span class="text-green-500 text-sm">
                        {{restaurant.tags|default:'Lagos, Tasty'}}
                    </span>
                    <!-- <span>•</span> -->
                    <span class="text-sm">
                        {{restaurant.open_time}} - {{restaurant.close_time}}
                    </span>

                    <!-- <span></span> -->
                </div>
            </div>
        </div>
    </section>

    <section>

        <!-- name of each tab group should be unique -->
        <div class="tabs tabs-lift text-center">
            <label class="tab rounded-2xl mb-3">
                <input type="radio" name="my_tabs_4" />
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 me-2">
                    <path
                        d="M10 2a.75.75 0 0 1 .75.75v5.59l1.95-2.1a.75.75 0 1 1 1.1 1.02l-3.25 3.5a.75.75 0 0 1-1.1 0L6.2 7.26a.75.75 0 1 1 1.1-1.02l1.95 2.1V2.75A.75.75 0 0 1 10 2Z" />
                    <path
                        d="M5.273 4.5a1.25 1.25 0 0 0-1.205.918l-1.523 5.52c-.006.02-.01.041-.015.062H6a1 1 0 0 1 .894.553l.448.894a1 1 0 0 0 .894.553h3.438a1 1 0 0 0 .86-.49l.606-1.02A1 1 0 0 1 14 11h3.47a1.318 1.318 0 0 0-.015-.062l-1.523-5.52a1.25 1.25 0 0 0-1.205-.918h-.977a.75.75 0 0 1 0-1.5h.977a2.75 2.75 0 0 1 2.651 2.019l1.523 5.52c.066.239.099.485.099.732V15a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-3.73c0-.246.033-.492.099-.73l1.523-5.521A2.75 2.75 0 0 1 5.273 3h.977a.75.75 0 0 1 0 1.5h-.977Z" />
                </svg>

                Pickup
            </label>
            <div
                class="tab-content items-center justify-center text-center bg-base-100 rounded-2xl border-base-300 p-6">
                <div class="flex w-full flex-col items-center justify-center">
                    <img src="{%static 'images/orderPack.png'%}" class="w-26 h-26 object-cover">
                    <span>Upgrade to Skiiiplus to use the Pickup feature.</span>
                    <!-- <a href="#" class="bg-black text-primary mt-2 px-3 py-2 rounded-2xl ">Upgrade Now</a> -->
                    <a href="#" class="text-black mt-2 flex gap-2 items-center ">Upgrade Now <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 text-primary">
  <path fill-rule="evenodd" d="M5.22 14.78a.75.75 0 0 0 1.06 0l7.22-7.22v5.69a.75.75 0 0 0 1.5 0v-7.5a.75.75 0 0 0-.75-.75h-7.5a.75.75 0 0 0 0 1.5h5.69l-7.22 7.22a.75.75 0 0 0 0 1.06Z" clip-rule="evenodd" />
</svg>
</a>

                </div>

            </div>

            <label class="tab rounded-2xl mb-3">
                <input type="radio" name="my_tabs_4" checked="checked" />
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"
                    class="size-5 me-2">
                    <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                    <path
                        d="m21.96,7.74s-.02-.05-.03-.07c-.02-.06-.04-.11-.07-.17-.02-.03-.04-.05-.06-.08-.03-.04-.06-.09-.1-.13-.03-.03-.06-.04-.08-.07-.04-.03-.07-.06-.11-.09,0,0,0,0-.01,0,0,0,0,0,0,0L12.49,2.13c-.3-.17-.67-.17-.97,0L2.58,7.1s-.06.02-.09.04c-.31.18-.49.51-.49.86v8c0,.36.2.7.51.87l9,5s.1.04.14.06c.03.01.06.03.09.03.08.02.17.03.25.03s.17-.01.25-.03c.03,0,.06-.02.09-.03.05-.02.1-.03.14-.06l9-5c.32-.18.51-.51.51-.87v-8c0-.09-.01-.18-.04-.26Zm-9.96-3.59l6.94,3.86-2.24,1.25-6.84-3.91,2.14-1.19Zm0,7.71l-6.92-3.86,2.74-1.52,6.84,3.91-2.65,1.47Zm8,3.56l-7,3.89v-5.71l3-1.67v3.08l2-1v-3.19l2-1.11v5.71Z">
                    </path>
                </svg>
                Delivery
            </label>
            <div class="tab-content bg-base-100 rounded-2xl border-base-300 p-6">
                <div class="flex w-full flex-col items-center justify-center">
                    <img src="{%static 'images/deldel.png'%}" class="w-26 h-26 object-cover">
                    <span>Please note that the Delivery Man will arrive your location in 40 mins, pay
                        only 2k...
                    </span>
                </div>


            </div>

        </div>
    </section>

    <br>

    <!-- Floating Menu Categories Scroll -->
    {%if categories|length > 0%}
    <section class="bg-white sticky rounded-2xl top-16 z-50 border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-center space-x-6 overflow-x-auto scrollbar-hide" id="menu-categories">
                <a href="#popular"
                    class="flex-shrink-0 text-primary border-b-2 border-primary pb-2 font-medium text-sm">
                    Popular
                </a>
                {% for category in categories %}
                <a href="#cat-{{ category.id }}"
                    class="flex-shrink-0 text-gray-600 hover:text-primary pb-2 font-medium text-sm transition-colors">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
        </div>
    </section>
    {%endif%}

    <!-- Special Offers Banner -->


    <!-- Menu Items Grid -->
    <section class="py-6" id="menu-items">

        <div class="max-w-7xl mx-auto px-3">

            <!-- Popular Items -->
            {%if most_popular%}


            <div class="mb-3">
                <h2 class="text-xl font-bold mb-2 flex items-center">
                    <i class="fas fa-fire text-primary mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                            fill="currentColor" class="size-5">
                            <path fill-rule="evenodd"
                                d="M13.5 4.938a7 7 0 1 1-9.006 1.737c.202-.257.59-.218.793.039.278.352.594.672.943.954.332.269.786-.049.773-.476a5.977 5.977 0 0 1 .572-2.759 6.026 6.026 0 0 1 2.486-2.665c.247-.14.55-.016.677.238A6.967 6.967 0 0 0 13.5 4.938ZM14 12a4 4 0 0 1-4 4c-1.913 0-3.52-1.398-3.91-3.182-.093-.429.44-.643.814-.413a4.043 4.043 0 0 0 1.601.564c.303.038.531-.24.51-.544a5.975 5.975 0 0 1 1.315-4.192.447.447 0 0 1 .431-.16A4.001 4.001 0 0 1 14 12Z"
                                clip-rule="evenodd" />
                        </svg>
                    </i>
                    Most Popular
                </h2>

                <div id="category-scroll-container" id="popular"
                    class="flex overflow-x-auto -mx-4 px-4 sm:px-0 sm:-mx-0 scroll-smooth no-scrollbar">
                    <!-- Promotions -->
                    {%for e in most_popular%}

                    <a href="" class="text-decoration-none openDetail" data-id="{{ e.id }}" data-name="{{ e.name }}"
                        data-price="{{ e.price }}" data-image="{{ e.image.url }}"
                        data-ingredients="{{ e.ingredients|default:'Freshly bought ingredients'|escapejs }}"
                        data-description="{{ e.description|default:'This meal is freshly cooked out of the Kitchen!'|escapejs }}"
                        data-url="" data-description="{{ e.description }}" data-calories="{{ e.calories|default:'0' }}"
                        data-tags="{{ e.tags|default:'No tags'|escapejs }}">
                        <div href=""
                            class="flex-shrink-0 w-[calc(50%-12px)] sm:w-[calc(33.33%-16px)] md:w-[calc(25%-16px)] lg:w-[calc(33.33%-16px)] xl:w-[calc(25%-16px)] mr-3 mb-2 sm:mr-4">
                            <div class="rounded-lg hover:shadow-lg transition-shadow">
                                <div class="p-3 sm:p-4">
                                    <img src="{{e.image.url}}?w=300&h=200&fit=crop" alt="Pizza & Pasta"
                                        class="w-full shadow-md h-20 sm:h-24 object-cover rounded-xl mb-2 sm:mb-3">
                                    <!-- <div class="flex mb-2"> -->
                                    <h3 class="text-sm font-semibold line-clamp-2 min-h-10">
                                        {{e.name|truncatewords:3}}
                                    </h3>



                                    <!-- </div> -->
                                    <!-- <div class="flex items-center justify-between"> -->
                                    <div class="flex items-center justify-between gap-2">

                                        <h3 class="text-sm text-black font-bold flex gap-2 items-center">
                                            ₦{{e.price|intcomma}}</h3>
                                        <a href="#" class="text-decoration-none">
                                            <div class="flex items-center text-xs text-gray-500 font-semibold">
                                                <i class="fas fa-star text-primary mr-1">
                                                </i>
                                                <!-- <span>{{m.rating}}</span> -->
                                            </div>
                                        </a>
                                    </div>

                                    <!-- </div> -->
                                </div>
                            </div>
                        </div>
                    </a>


                    {%endfor%}



                    <!-- Add more category cards as needed -->
                </div>
                <br>

            </div>

            {%endif%}



            <!-- End of Popular Items -->
            {%for c in categories%}
            <div class="relative">
                <h2 class="text-xl font-bold mb-2 flex items-center">
                    <i class="fas fa-fire text-primary mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                            fill="currentColor" class="size-5">
                            <path
                                d="M12 9a1 1 0 0 1-1-1V3c0-.552.45-1.007.997-.93a7.004 7.004 0 0 1 5.933 5.933c.078.547-.378.997-.93.997h-5Z" />
                            <path
                                d="M8.003 4.07C8.55 3.994 9 4.449 9 5v5a1 1 0 0 0 1 1h5c.552 0 1.008.45.93.997A7.001 7.001 0 0 1 2 11a7.002 7.002 0 0 1 6.003-6.93Z" />
                        </svg>
                    </i>
                    {{c.name}}
                </h2>


                <div class="relative">

                    <!-- Category Items -->
                    {%if c.menu_items.all%}
                    <div id="category-scroll-container" id="eateries-list"
                        class="flex overflow-x-auto -mx-4 px-4 sm:px-0 sm:-mx-0 scroll-smooth no-scrollbar">
                        <!-- Promotions -->
                        {%for e in c.menu_items.all%}

                        <a href="" class="text-decoration-none openDetail" data-id="{{ e.id }}" data-name="{{ e.name }}"
                            data-price="{{ e.price }}" data-image="{{ e.image.url }}"
                            data-ingredients="{{ e.ingredients|default:'Freshly bought ingredients'|escapejs }}"
                            data-description="{{ e.description|default:'This meal is freshly cooked out of the Kitchen!'|escapejs }}"
                            data-url="" data-description="{{ e.description }}"
                            data-calories="{{ e.calories|default:'0' }}"
                            data-tags="{{ e.tags|default:'No tags'|escapejs }}">
                            <div href=""
                                class="flex-shrink-0 w-[calc(50%-12px)] sm:w-[calc(33.33%-16px)] md:w-[calc(25%-16px)] lg:w-[calc(33.33%-16px)] xl:w-[calc(25%-16px)] mr-3 mb-2 sm:mr-4">
                                <div class="rounded-lg hover:shadow-lg transition-shadow">
                                    <div class="p-3 sm:p-4">
                                        <img src="{{e.image.url}}?w=300&h=200&fit=crop" alt="Pizza & Pasta"
                                            class="w-full shadow-md h-20 sm:h-24 object-cover rounded-xl mb-2 sm:mb-3">
                                        <!-- <div class="flex mb-2"> -->
                                        <h3 class="text-sm font-semibold line-clamp-2 min-h-10">
                                            {{e.name|truncatewords:3}}
                                        </h3>



                                        <!-- </div> -->
                                        <!-- <div class="flex items-center justify-between"> -->
                                        <div class="flex items-center justify-between gap-2">

                                            <h3 class="text-sm text-black font-bold flex gap-2 items-center">
                                                ₦{{e.price|intcomma}}</h3>
                                            <a href="#" class="text-decoration-none">
                                                <div class="flex items-center text-xs text-gray-500 font-semibold">
                                                    <i class="fas fa-star text-primary mr-1">
                                                    </i>
                                                    <!-- <span>{{m.rating|default:'1.8'}}</span> -->
                                                </div>
                                            </a>
                                        </div>

                                        <!-- </div> -->
                                    </div>
                                </div>
                            </div>
                        </a>


                        {%endfor%}



                        <!-- Add more category cards as needed -->
                    </div>
                    <br>
                    {%endif%}

                </div>
            </div>
            {%endfor%}


    </section>
    <!-- Overlay and Modal Container -->
    <!-- MODAL BACKDROP -->
    <div id="mealModalBackdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <!-- MODAL SLIDE-UP -->
    <div id="mealModal"
        class="fixed bottom-0 left-0 w-full flex flex-col justify-center items-center h-[95vh] bg-white z-50 rounded-t-3xl shadow-2xl translate-y-full transition-transform duration-300 ease-in-out py-4 px-2">
        <div class="p-4 space-y-4 h-full max-w-5xl overflow-y-auto no-scrollbar">
            <div class="flex justify-between items-center">
                <button id="closeModal" class="bg-gray-200 p-3 rounded-2xl text-xl m-2"><svg
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
                        <path fill-rule="evenodd"
                            d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                            clip-rule="evenodd" />
                    </svg>
                </button>


            </div>
            <img id="modalMealImage" src="" alt=""
                class="w-full lg:max-w-5xl text-center h-60 object-cover rounded-3xl shadow" />
            <form id="modalForm" class="space-y-4">
                <h2 id="modalMealName" class="text-3xl mb-2 font-semibold"></h2>
                <div class="flex items-center justify-between mb-2">
                    <p class="font-bold text-3xl">₦<span id="modalMealPrice"></span></p>

                    <!-- Quantity Selector -->
                    <div class="flex items-center justify-center gap-4">
                        <button type="button" id="decreaseQty"
                            class="bg-gray-200 text-black p-3 rounded-2xl text-xl"><svg
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="size-5">
                                <path fill-rule="evenodd"
                                    d="M4 10a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75A.75.75 0 0 1 4 10Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <span id="qtyDisplay" class="text-2xl font-semibold">1</span>
                        <button type="button" id="increaseQty"
                            class="bg-gray-200 text-black p-3 rounded-2xl text-xl"><svg
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="size-5">
                                <path
                                    d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- <div class="mb-2 flex flex-col space-y-3">
                    <div class="flex items-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
                            <path fill-rule="evenodd"
                                d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94ZM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                                clip-rule="evenodd" />
                        </svg>
                        <p class="text-xl">About this meal</p>

                    </div>
                    <p id="modalMealDescription" class="text-gray-600 text-sm max-h-32 overflow-auto leading-relaxed">
                        This meal is freshly cooked out of the Kitchen!
                    </p>
                </div>
                <div class="mb-2 flex flex-col space-y-3">
                    <div class="flex items-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
                            <path
                                d="M2 4.25A2.25 2.25 0 0 1 4.25 2h2.5A2.25 2.25 0 0 1 9 4.25v2.5A2.25 2.25 0 0 1 6.75 9h-2.5A2.25 2.25 0 0 1 2 6.75v-2.5ZM2 13.25A2.25 2.25 0 0 1 4.25 11h2.5A2.25 2.25 0 0 1 9 13.25v2.5A2.25 2.25 0 0 1 6.75 18h-2.5A2.25 2.25 0 0 1 2 15.75v-2.5ZM11 4.25A2.25 2.25 0 0 1 13.25 2h2.5A2.25 2.25 0 0 1 18 4.25v2.5A2.25 2.25 0 0 1 15.75 9h-2.5A2.25 2.25 0 0 1 11 6.75v-2.5ZM15.25 11.75a.75.75 0 0 0-1.5 0v2h-2a.75.75 0 0 0 0 1.5h2v2a.75.75 0 0 0 1.5 0v-2h2a.75.75 0 0 0 0-1.5h-2v-2Z" />
                        </svg>
                        <p class="text-xl">Additional Info</p>

                    </div>
                    <p><strong>Ingredients:</strong> <span id="modalMealIngredients"></span></p>
                    <p><strong>Calories:</strong> <span id="modalMealCalories"></span> kcal</p>
                    <p><strong>Tags:</strong> <span id="modalMealTags"></span></p>
                </div> -->


                <input type="hidden" id="mealId" name="meal_id">


                <br><br>
                <!-- Add to Cart Button -->
                <div class="w-full max-w-5xl pt-2 sticky bottom-0 border-t shadow-t">
                    <button type="submit" id="addToCartBtn"
                        class="w-full bg-primary text-white py-4 rounded-2xl font-semibold transition-all">
                        Add to Cart
                    </button>
                </div>

            </form>
        </div>
    </div>

    <script>
        const modal = document.getElementById('mealModal');
        const modalDesc = document.getElementById('modalMealDescription');
        const modalIngredients = document.getElementById('modalMealIngredients');
        const modalCalories = document.getElementById('modalMealCalories');
        const modalTags = document.getElementById('modalMealTags');

        const backdrop = document.getElementById('mealModalBackdrop');
        const openButtons = document.querySelectorAll('.openDetail');
        const closeModal = document.getElementById('closeModal');

        const modalName = document.getElementById('modalMealName');
        const modalImage = document.getElementById('modalMealImage');
        const modalPrice = document.getElementById('modalMealPrice');
        const mealIdInput = document.getElementById('mealId');
        const qtyDisplay = document.getElementById('qtyDisplay');
        const addToCartBtn = document.getElementById('addToCartBtn');

        let currentQty = 1;

        // OPEN MODAL
        openButtons.forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const name = this.dataset.name;
                const price = this.dataset.price;
                const image = this.dataset.image;
                const id = this.dataset.id;
                const url = this.dataset.url;
                const desc = this.dataset.description;
                // Set modal content

                modalIngredients.textContent = this.dataset.ingredients;
                modalCalories.textContent = this.dataset.calories;
                modalTags.textContent = this.dataset.tags;

                modalName.textContent = name;
                modalImage.src = image;
                modalPrice.textContent = parseInt(price).toLocaleString();
                mealIdInput.value = id;
                modalDesc.textContent = desc;
                qtyDisplay.textContent = 1;
                currentQty = 1;
                addToCartBtn.dataset.url = url;
                addToCartBtn.disabled = false;
                addToCartBtn.textContent = 'Add to Cart';

                // Show modal and backdrop
                backdrop.classList.remove('hidden');
                modal.classList.remove('translate-y-full');
            });
        });

        // CLOSE MODAL
        closeModal.addEventListener('click', () => {
            modal.classList.add('translate-y-full');
            backdrop.classList.add('hidden');
        });

        // Quantity controls
        document.getElementById('increaseQty').addEventListener('click', () => {
            currentQty++;
            qtyDisplay.textContent = currentQty;
        });

        document.getElementById('decreaseQty').addEventListener('click', () => {
            if (currentQty > 1) {
                currentQty--;
                qtyDisplay.textContent = currentQty;
            }
        });

        // Submit form
        document.getElementById('modalForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const url = addToCartBtn.dataset.url;

            addToCartBtn.disabled = true;
            addToCartBtn.textContent = 'Adding...';

            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ quantity: currentQty })
            })
                .then(res => {
                    if (!res.ok) throw new Error("Failed to add to cart");
                    return res.json();
                })
                .then(data => {
                    addToCartBtn.textContent = 'Added ✔';
                    setTimeout(() => {
                        modal.classList.add('translate-y-full');
                        backdrop.classList.add('hidden');
                    }, 800);
                })
                .catch(err => {
                    alert('Error adding to cart');
                    addToCartBtn.disabled = false;
                    addToCartBtn.textContent = 'Add to Cart';
                });
        });
    </script>

    <!-- HTMX Scripts -->

</main>





{% endblock %}